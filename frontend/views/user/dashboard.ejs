<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Dashboard - AuctionHub</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white font-sans">

    <nav class="bg-gray-800 border-b border-gray-700 p-4">
        <div class="container mx-auto flex justify-between items-center">
            <a href="/" class="text-xl font-bold text-blue-500 hover:text-blue-400">AuctionHub</a>
            <div class="space-x-4 flex items-center">
                <a href="/api/auction/create" class="bg-yellow-500 text-black px-3 py-1 rounded text-sm font-bold hover:bg-yellow-400">
                    + Sell Item
                </a>
                <a href="/api/auth/logout" class="bg-red-600 px-4 py-2 rounded hover:bg-red-700 text-sm font-bold transition">
                    Logout
                </a>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-6 py-10">
        <div class="bg-gray-800 p-8 rounded-lg shadow-lg mb-8 border border-gray-700 flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold">Welcome, <%= user.name %> üëã</h1>
                <p class="text-gray-400 mt-2">Manage your bids and sales here.</p>
            </div>
            <div class="hidden md:block text-right">
                <p class="text-sm text-gray-500">Account Status</p>
                <p class="text-green-400 font-bold">Verified User</p>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            
            <div class="space-y-8">
                
                <div class="bg-gray-800 rounded-lg shadow-lg border border-gray-700 overflow-hidden">
                    <div class="bg-blue-600 p-4 font-bold">üõí My Bids</div>
                    <div class="p-4 max-h-60 overflow-y-auto">
                        <% if(bids.length === 0) { %>
                            <p class="text-gray-500 italic text-center py-4">No active bids.</p>
                            <a href="/api/auction" class="block text-center text-blue-400 mt-2 hover:underline">Browse Auctions</a>
                        <% } else { %>
                            <ul class="divide-y divide-gray-700">
                                <% bids.forEach(bid => { %>
                                    <li class="py-3 flex justify-between items-center">
                                        <div>
                                            <p class="font-bold text-sm"><%= bid.Auction ? bid.Auction.title : 'Item Removed' %></p>
                                            <p class="text-xs text-gray-500"><%= new Date(bid.createdAt).toLocaleDateString() %></p>
                                        </div>
                                        <span class="font-bold text-green-400">‡ß≥<%= bid.amount %></span>
                                    </li>
                                <% }) %>
                            </ul>
                        <% } %>
                    </div>
                </div>

                <div class="bg-gray-800 rounded-lg shadow-lg border border-gray-700 overflow-hidden">
                    <div class="bg-green-600 p-4 font-bold">üèÜ Auctions Won</div>
                    <div class="p-4">
                        <% 
                           // Filter logic: Auction ended AND user has the highest bid
                           const wonAuctions = bids.filter(b => b.Auction && new Date(b.Auction.endTime) < new Date() && b.Auction.currentPrice == b.amount); 
                        %>
                        <% if(wonAuctions.length === 0) { %>
                            <p class="text-gray-500 italic text-center">No wins yet.</p>
                        <% } else { %>
                            <ul class="divide-y divide-gray-700">
                                <% wonAuctions.forEach(win => { %>
                                    <li class="py-3 flex justify-between items-center">
                                        <span class="font-bold text-yellow-400"><%= win.Auction.title %></span>
                                        <a href="/api/payment/<%= win.Auction.id %>" class="text-xs bg-blue-600 px-2 py-1 rounded hover:bg-blue-500">Pay Now</a>
                                    </li>
                                <% }) %>
                            </ul>
                        <% } %>
                    </div>
                </div>
            </div>

            <div class="bg-gray-800 rounded-lg shadow-lg border border-gray-700 overflow-hidden h-full">
                <div class="bg-purple-600 p-4 font-bold flex justify-between">
                    <span>üì¶ My Listings (Items I'm Selling)</span>
                    <a href="/api/auction/create" class="text-xs bg-black/30 px-2 py-1 rounded hover:bg-black/50">+ New</a>
                </div>
                
                <div class="p-4">
                    <% if(listings.length === 0) { %>
                        <div class="text-center py-10">
                            <p class="text-gray-500 italic">You aren't selling anything yet.</p>
                            <a href="/api/auction/create" class="inline-block mt-4 bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-500 transition">Start Selling</a>
                        </div>
                    <% } else { %>
                        <table class="w-full text-left">
                            <thead>
                                <tr class="text-gray-400 border-b border-gray-700 text-sm">
                                    <th class="pb-2">Item</th>
                                    <th class="pb-2">Price</th>
                                    <th class="pb-2 text-right">Status</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-700">
                                <% listings.forEach(item => { %>
                                    
                                    <% const isExpired = new Date(item.endTime) < new Date(); %>

                                    <tr class="hover:bg-gray-750">
                                        <td class="py-3 font-bold text-sm">
                                            <%= item.title %>
                                            <a href="/api/auction/<%= item.id %>" class="text-xs text-blue-400 block font-normal hover:underline">View</a>
                                        </td>
                                        <td class="py-3 text-sm">‡ß≥<%= item.currentPrice %></td>
                                        <td class="py-3 text-right">
                                            
                                            <% if(item.status === 'pending') { %>
                                                <span class="bg-yellow-600/20 text-yellow-500 text-xs px-2 py-1 rounded border border-yellow-600/50">
                                                    ‚è≥ Pending Approval
                                                </span>
                                            
                                            <% } else if (isExpired) { %>
                                                <span class="bg-red-600/20 text-red-500 text-xs px-2 py-1 rounded border border-red-600/50">
                                                    üö´ Ended
                                                </span>

                                            <% } else { %>
                                                <span class="bg-green-600/20 text-green-500 text-xs px-2 py-1 rounded border border-green-600/50">
                                                    üü¢ Active
                                                </span>
                                            <% } %>

                                        </td>
                                    </tr>
                                <% }) %>
                            </tbody>
                        </table>
                    <% } %>
                </div>
            </div>

        </div>
    </div>

</body>
</html>